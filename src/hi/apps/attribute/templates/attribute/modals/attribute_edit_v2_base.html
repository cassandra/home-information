{% extends "modals/base.html" %}
{% load icons %}

{% block modal_dialog_class %}hi-modal-dialog-700{% endblock %}

{% block title_text %}
{% block modal_title %}Item: Edit{% endblock %}
{% endblock %}

{% block body %}
<form id="attr-v2-form" 
      action="{% block form_action %}#{% endblock %}" 
      method="post" 
      class="form attr-v2-modal" 
      data-async="true"
      data-stay-in-modal="true"
      enctype="multipart/form-data"
      data-file-delete-url="{% block file_delete_url %}#{% endblock %}">
  {% csrf_token %}
  
<!-- Main content wrapper for antinode updates -->
<div id="attr-v2-content">
  {% include "attribute/components/v2/content_body.html" %}
</div>
</form>

<!-- File Upload Form Container (separate from main form to avoid nesting) -->
<div id="attr-v2-upload-form-container">
  {% block file_upload_form %}
    <!-- Default form using entity context -->
    {% include "attribute/components/v2/upload_form.html" %}
  {% endblock %}
</div>

<!-- Success/Error Messages -->
{% if messages %}
  <div class="attr-v2-messages" id="attr-v2-messages">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    {% endfor %}
  </div>
{% endif %}

<!-- Modal-over-Modal Container for History and Other Overlays -->
<div id="attr-v2-overlay-modal" class="attr-v2-modal-overlay" style="display: none;">
  <div class="attr-v2-overlay-content">
    <div class="attr-v2-overlay-header">
      <h6 id="attr-v2-overlay-title"><!-- Dynamic title --></h6>
      <button type="button" 
              class="btn btn-sm btn-outline-secondary"
              onclick="closeOverlayModal()"
              title="Close overlay">
        {% icon "close" size="sm" %}
      </button>
    </div>
    <div class="attr-v2-overlay-body" id="attr-v2-overlay-body">
      <!-- Dynamic content loaded here -->
    </div>
  </div>
</div>

<!-- JavaScript for V2 functionality loaded via Django Pipeline js_before_content bundle -->

{% endblock %}

{% block footer %}
<!-- No footer - sticky panel contains all actions -->
{% endblock %}