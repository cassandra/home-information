{% load icons %}
{% load tz %}
{% load humanize %}
{% timezone USER_TIMEZONE %}

<div class="{{ api_health_status.border_color_class }} mb-4">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h5 class="mb-0">{{ api_health_status.provider_name }}</h5>
    <span class="badge {{ api_health_status.status_badge_class }}">
      {% icon api_health_status.status_icon size="sm" css_class="mr-1" %}{{ api_health_status.status.label }}
    </span>
  </div>
  
  {% if api_health_status.last_error_message %}
  <div class="row">
    <div class="col-sm-3"><strong>Last Error:</strong></div>
    <div class="zzz col-sm-9">{{ api_health_status.last_error_message }}</div>
  </div>
  {% endif %}
  
  {% if api_health_status.last_success %}
  <div class="row">
    <div class="col-sm-3"><strong>Last Success:</strong></div>
    <div class="col-sm-9">{{ api_health_status.last_success|localtime|date:"M j, Y H:i:s" }}</div>
  </div>
  {% endif %}
  
  <div class="api-metrics-grid mt-2">
    <div class="metric-item {{ api_health_status.status_css_class }}">
      <div class="small text-muted-custom">Total Calls</div>
      <div class="metric-value">{{ api_health_status.total_calls|intcomma }}</div>
    </div>
    <div class="metric-item {{ api_health_status.status_css_class }}">
      <div class="small text-muted-custom">Success Rate</div>
      <div class="metric-value">
        {% if api_health_status.total_calls %}
        {{ api_health_status.success_rate_percentage|floatformat:1 }}%
        {% else %}
        ---
        {% endif %}
      </div>
    </div>
    {% if api_health_status.last_response_time %}
    <div class="metric-item {{ api_health_status.status_css_class }}">
      <div class="small text-muted-custom">Last Response</div>
      <div class="metric-value">{{ api_health_status.last_response_time|floatformat:2 }}s</div>
    </div>
    {% elif api_health_status.average_response_time %}
    <div class="metric-item {{ api_health_status.status_css_class }}">
      <div class="small text-muted-custom">Avg Response</div>
      <div class="metric-value">{{ api_health_status.average_response_time|floatformat:2 }}s</div>
    </div>
    {% else %}
    <div class="metric-item {{ api_health_status.status_css_class }}">
      <div class="small text-muted-custom">Response Time</div>
      <div class="metric-value">---</div>
    </div>
    {% endif %}
    {% if api_health_status.total_failures > 0 or api_health_status.consecutive_failures > 0 %}
    <div class="metric-item {{ api_health_status.status_css_class }}">
      <div class="small text-muted-custom">
        {% if api_health_status.consecutive_failures > 0 %}Consecutive Failures{% else %}Total Failures{% endif %}
      </div>
      <div class="metric-value">
        {% if api_health_status.consecutive_failures > 0 %}{{ api_health_status.consecutive_failures|intcomma }}{% else %}{{ api_health_status.total_failures|intcomma }}{% endif %}
      </div>
    </div>
    {% endif %}
  </div>
  
  <!-- Cache Statistics -->
  {% if api_health_status.cache_hits > 0 or api_health_status.cache_misses > 0 %}
  <div class="cache-stats mt-2">
    <small class="text-muted">
      Cache: {{ api_health_status.cache_hits|intcomma }} hits, {{ api_health_status.cache_misses|intcomma }} misses
      {% if api_health_status.cache_hit_rate_percent %}
      ({{ api_health_status.cache_hit_rate_percent|floatformat:1 }}% hit rate)
      {% endif %}
    </small>
  </div>
  {% endif %}
</div>
{% endtimezone %}
