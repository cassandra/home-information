{% load tz %}
{% load humanize %}
{% timezone USER_TIMEZONE %}
<div class="timeline-container">
  {% if event_history_list %}
    <div class="timeline-items">
      {% for event_history in event_history_list %}
      <div class="timeline-item mb-2">
        <div class="card border-left-primary">
          <div class="card-body py-2 px-3">
            <div class="row align-items-center">
              <div class="col-md-3 col-sm-4">
                <div class="text-center">
                  {% if event_history.event_datetime|localtime|date:"Y-m-d" == today %}
                    <strong class="text-primary d-block">Today {{ event_history.event_datetime|localtime|date:"g:i A" }}</strong>
                  {% elif event_history.event_datetime|localtime|date:"Y-m-d" == yesterday %}
                    <strong class="text-primary d-block">Yesterday {{ event_history.event_datetime|localtime|date:"g:i A" }}</strong>
                  {% else %}
                    <strong class="text-primary d-block">{{ event_history.event_datetime|localtime|date:"l, M j" }}</strong>
                    <span class="text-primary">{{ event_history.event_datetime|localtime|date:"g:i A" }}</span>
                  {% endif %}
                  <small class="text-muted d-block">{{ event_history.event_datetime|localtime|naturaltime }}</small>
                </div>
              </div>
              <div class="col-md-5 col-sm-8">
                <div>
                  <strong class="d-block mb-1">{{ event_history.event_definition.name }}</strong>
                  <span class="badge badge-info mr-2">{{ event_history.event_definition.event_type.label }}</span>
                  <span class="badge badge-secondary">{{ event_history.entity_count }} entities</span>
                </div>
              </div>
              <div class="col-md-4 col-12">
                {% if event_history.entity_names %}
                <div class="mt-1 mt-md-0">
                  <small class="text-muted d-block">Involved Entities:</small>
                  <small class="text-info">
                    {% for name in event_history.entity_names %}
                      {{ name }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                  </small>
                </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="card border-0 bg-light">
      <div class="card-body text-center py-4">
        <i class="fas fa-clock text-muted fa-2x mb-3"></i>
        <h6 class="text-muted">No Event History</h6>
        <p class="text-muted mb-0">No trigger events have been recorded yet.</p>
      </div>
    </div>
  {% endif %}
</div>
{% endtimezone %}
